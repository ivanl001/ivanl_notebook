{
  "title": "04-Hive-0201-Hive02:åŠ¨æ€åˆ†åŒºå’Œäº‹åŠ¡æ”¯æŒ",
  "cells": [
    {
      "type": "markdown",
      "data": "## 1ï¼ŒHiveçš„ä½¿ç”¨02"
    },
    {
      "type": "markdown",
      "data": "* select * from TBLS \\G;  ğŸ˜\\Gæ˜¯è¡Œè½¬åˆ—ï¼Œåœ¨æŸ¥çœ‹çš„æ—¶å€™æ¯”è¾ƒæ–¹ä¾¿ä¸€äº›ï¼ŒæŠ€èƒ½+1ï¼›"
    },
    {
      "type": "markdown",
      "data": "\n### 01ï¼Œè‡ªåŠ¨åˆ†åŒº(åŠ¨æ€åˆ†åŒº)ï¼š\n  *åœ¨åŠ å…¥çš„æ—¶å€™æ ¹æ®åŠ å…¥æ•°æ®çš„å­—æ®µè‡ªåŠ¨åˆ†åŒºï¼Œè€Œä¸å¿…æŠŠåˆ†åŒºæ•°æ®å®šæ­»ã€‚å¦‚ä¸‹ï¼Œæ¼”ç¤ºä¸€ä¸‹åŠ¨æ€åˆ†åŒº*\n\n  * é¦–å…ˆåˆ›å»ºä¸€ä¸ªæœ‰å¹´ä»½å’Œæœˆä»½çš„è¡¨ï¼Œç”¨ä½œæ•°æ®æ’å…¥çš„å…ƒæ•°æ®\n    > create table t7 (id int , name string , age int, year string, month string);\n  \n  * ç„¶åæ’å…¥ä¸¤æ¡ä¸åŒå¹´ä»½æˆ–æœˆä»½çš„æ•°æ®å§\n    > insert into t7 (id, name, age, year, month) values (1, \"ivanl0000\", 10, 2015, 12);\n  \n    > insert into t7 (id, name, age, year, month) values (2, \"ivanl111111\", 15, 2016, 11);\n  \n  * ç„¶åæŠŠä¸Šé¢è¡¨ä¸­çš„ä¸¤æ¡æ•°æ®æ’å…¥åˆ°æˆ‘ä»¬ä¹‹å‰å»ºçš„åˆ†åŒºè¡¨t5ä¸­å»ï¼Œå› ä¸ºå¹¶æ²¡æœ‰å¼€å¯åŠ¨æ€åˆ†åŒºï¼Œä¼šæŠ¥é”™ï¼š\n    > insert into t5 partition (year, month) select id, name, age, year, month from t7;\n  \n  * ä¸Šé¢çš„æ’å…¥ä¼šæŠ¥é”™, é»˜è®¤ä¸¥æ ¼æ¨¡å¼ï¼Œä¸¥æ ¼æ¨¡å¼åœ¨æ’å…¥æ—¶å€™å¿…é¡»è¦æŒ‡å®šä¸€ä¸ªé™æ€åˆ†åŒºï¼Œæˆ‘ä»¬å…³é—­è¿™ä¸ªä¸¥æ ¼æ¨¡å¼å³å¯ï¼š\n    > FAILED: SemanticException [Error 10096]: Dynamic partition strict mode requires at least one static partition column. To turn this off set hive.exec.dynamic.partition.mode=nonstrict\n  \n  * æ ¹æ®æç¤ºå¯ä»¥çŸ¥é“éœ€è¦è®¾ç½®åˆ†åŒºæ¨¡å¼ä¸ºéä¸¥æ ¼æ¨¡å¼\n    > set hive.exec.dynamic.partition.mode=nonstrict\n  \n  * é‡æ–°æ’å…¥å‘ç°okäº†\n  \n  "
    },
    {
      "type": "markdown",
      "data": "### 02ï¼Œhiveçš„äº‹åŠ¡\n\n*åªæœ‰ç”¨äº‹åŠ¡æ‰èƒ½æ”¯æŒè¡Œçº§æ“ä½œï¼Œæ¯”å¦‚æ›´æ–°ï¼Œåˆ é™¤æŸä¸€è¡Œç­‰ç­‰*\n \n  * ä½¿ç”¨äº‹åŠ¡å¿…é¡»è¦å…ˆé…ç½®å¦‚ä¸‹ï¼š\n    ```properties\n    1.æ‰€æœ‰äº‹åŠ¡è‡ªåŠ¨æäº¤ã€‚\n    2.åªæ”¯æŒorcæ ¼å¼ã€‚\n    3.ä½¿ç”¨bucketè¡¨ã€‚\n    4.é…ç½®hiveå‚æ•°ï¼Œä½¿å…¶æ”¯æŒäº‹åŠ¡ã€‚\n  \t\n  \t###### æ³¨æ„ï¼šä¸‹é¢å¦‚æœåªæ˜¯åœ¨å‘½ä»¤è¡Œè®¾ç½®è€Œä¸æ”¹å˜é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆåªä¼šå•æ¬¡æœ‰æ•ˆå“ˆ\n  \t\n    SET hive.support.concurrency = true;\t\t\t\t\n    SET hive.enforce.bucketing = true;\n    //ä¸Šé¢ä¼šæŠ¥é”™Query returned non-zero code: 1, cause: hive configuration hive.enforce.bucketing does not exists.ï¼Œå…ˆå¿½ç•¥\n    SET hive.exec.dynamic.partition.mode = nonstrict;\t\n    SET hive.txn.manager = org.apache.hadoop.hive.ql.lockmgr.DbTxnManager;\n    SET hive.compactor.initiator.on = true;\n    SET hive.compactor.worker.threads = 1;\n    ```\n  \n  * æ˜¾ç¤ºå½“å‰è¿è¡Œçš„äº‹åŠ¡\n    > show transactions;\n  \n  * æ›´æ–°æ“ä½œ(é»˜è®¤ä½¿ç”¨äº‹åŠ¡è‡ªåŠ¨æäº¤)\n    > update t2 set name = 'ivanl001' where id = 2;\n    * å…¶å®ä¼šæŠ¥é”™ï¼šFAILED: SemanticException [Error 10297]: Attempt to do update or delete on table imdb.t2 that does not use an AcidOutputFormat or is not bucketedï¼Œ å› ä¸ºè¡¨ä¸æ˜¯æ¡¶è¡¨\n    \n  * æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦é‡æ–°å»ºç«‹ä¸€ä¸ªæ¡¶è¡¨,ä½†æ˜¯è·Ÿä¹‹å‰ä¸ä¸€æ ·ï¼Œè¿™é‡Œéœ€è¦é¢å¤–è®¾ç½®å­˜å‚¨æ ¼å¼ä¸ºorc\n    > create table t8 (id int, name string, age int) clustered by (id) into 3 buckets row format delimited fields terminated by ',' stored as orc;\n\n  * å› ä¸ºloadæ˜¯æ²¡åŠæ³•å®Œæˆåˆ†æ¡¶æ“ä½œçš„ï¼Œ æ‰€ä»¥è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œ ç›´æ¥ä»t5è¡¨ä¸­æ‹·è´è¿‡æ¥\n    > insert into t8 select id, name, age from t5;\n\n  * æ‰§è¡Œæ›´æ–°æ“ä½œ\n    > update t8 set name = \"ivanl001\" where id = 3;\n    * ä¸è¿‡è¿˜æ˜¯ä¼šæŠ¥é”™ï¼š FAILED: SemanticException [Error 10122]: Bucketized tables do not support INSERT INTO: Table: imdb.t8\n    * æœ€åå‘ç°æ˜¯æœ‰ä¸€ä¸ªå±æ€§éœ€è¦åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®šï¼Œæ‰€ä»¥æˆ‘ä»¬é‡æ–°åˆ›å»ºè¡¨t9, å…·ä½“å±æ€§å¦‚ä¸‹\n  \n  * é‡æ–°åˆ›å»ºæ–°è¡¨t9:éœ€è¦è®¾ç½®å±æ€§TBLPROPERTIES, æ³¨æ„ï¼šå•è¯åˆ«å†™é”™äº†ï¼Œåƒè¿‡äº\n    > create table t9 (id int, name string, age int) clustered by (id) into 3 buckets row format delimited fields terminated by ',' stored as orc tblproperties  ('transactional'='true');\n \n  * ç„¶åé‡æ–°æŠŠæ•°æ®æ‹·è´è¿‡æ¥\n    > insert into t9 select id, name, age from t5;\n\n  * æ‰§è¡Œæ›´æ–°æ“ä½œ\n    > update t9 set name = \"ivanl001\" where id = 3;\n\n  * è¿™æ¬¡å°±okå•¦ã€‚å˜¿å˜¿ğŸ˜"
    },
    {
      "type": "markdown",
      "data": ""
    },
    {
      "type": "markdown",
      "data": "## 03ï¼Œgroup by\n*æ³¨æ„ï¼šåˆ†ç»„èšåˆçš„è¯ï¼Œselectçš„ä¿¡æ¯åªèƒ½æ˜¯ç»„çš„ä¿¡æ¯ï¼Œè€Œä¸èƒ½æ˜¯æ¯ä¸€æ¡çš„ä¿¡æ¯äº†ï¼Œ æ¯”å¦‚è¯´æŒ‰ç…§ç”¨æˆ·åˆ†ç»„ï¼Œé‚£ä¹ˆèƒ½æŸ¥å‡ºæ¥çš„è‚¯å®šæ˜¯è¿™ä¸ªç”¨æˆ·çš„æ¯”å¦‚è¯´è®¢å•æ•°é‡ï¼Œ è®¢å•æ€»é‡‘é¢ç­‰ç­‰ï¼Œè€Œä¸èƒ½æ˜¯å…·ä½“è®¢å•ç­‰ä¿¡æ¯*\n  * select id, name, price , cid from orders group by cid;\n    * æ‰€ä»¥è¿™ä¸ªä¼šç›´æ¥æŠ¥é”™ï¼šFAILED: SemanticException [Error 10025]: Line 1:7 Expression not in GROUP BY key 'id'\n    \n  * select count(*), sum(price), cid from orders group by cid;//è¿™æ ·æ˜¯å¯ä»¥çš„\n  \n  * select count(*), sum(price) as s, cid from orders group by cid having cid > 30;//åˆ†ç»„ä¹‹åå†è¿›è¡Œæ¡ä»¶ç­›é€‰"
    },
    {
      "type": "markdown",
      "data": ""
    },
    {
      "type": "markdown",
      "data": "\n\n\n\n\n\n\n\n\n\n\n\n\n#ddd"
    }
  ]
}